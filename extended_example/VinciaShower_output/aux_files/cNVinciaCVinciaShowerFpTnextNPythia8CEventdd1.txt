@startuml

start
 skinparam activityBackgroundColor #white 
:#84add6:Check for reasons not to do anything;
note right
possible STOP
end note
:#84add6:For strong ordering, ensure our starting scale is below all old scales;
partition #84add6 "Get trial scale for each antenna, the highest one is our branching scale" {

while (FOR (int iAnt = 0 ; iAnt < evPtr -> nAnt ( ) ; ++ iAnt ))

   if (does the anntenna have a saved trial scale we can still use?) then(yes)
      :#b2cce5:Lookup saved trial scale;
   elseif (is the antenna ready for hadronization?) then (yes)
      :#b2cce5:set the trial scale to zero;
   elseif (is the starting scale below the stopping scale?) then (yes)
      :#b2cce5:set the trial scale to zero;
   else(no)
      :#b2cce5:Make sure every trial generator of the antenna has a trial scale;
      :#b2cce5:Select the highest scale among trial generator scales;
   endif

endwhile

}

if (check whether branching scale is above stopping scale) then(yes)
else(no)
   :#84add6:Do cleanup since the shower will stop;
endif

:#84add6:End of pTnext: finalize and return to PYTHIA;

@enduml